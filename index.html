<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de PÃ¡tio</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
--azul:#1565c0;
--verde:#2e7d32;
--vermelho:#c62828;
--laranja:#ef6c00;
--cinza:#eceff1;
}

body{
font-family: Arial, Helvetica, sans-serif;
margin:0;
background:var(--cinza);
padding:12px;
}

h1{ text-align:center; }

.box{
background:white;
padding:10px;
border-radius:10px;
margin-bottom:10px;
}

input,select,button{
width:100%;
padding:10px;
margin-top:6px;
font-size:15px;
border-radius:8px;
border:1px solid #ccc;
}

button{
border:none;
background:var(--azul);
color:white;
}

.urgencias{
background:#fff3e0;
border-left:6px solid var(--laranja);
padding:8px;
border-radius:8px;
margin-bottom:10px;
font-size:14px;
}

.card{
border-radius:10px;
padding:10px;
margin-bottom:10px;
background:white;
box-shadow:0 2px 4px rgba(0,0,0,0.08);
}

.card.demurrage{ border-left:6px solid var(--vermelho); }
.card.deadline{ border-left:6px solid var(--laranja); }
.card.saiu{ opacity:0.55; }

.tag{
display:inline-block;
padding:3px 6px;
border-radius:6px;
font-size:12px;
margin-right:4px;
background:#ddd;
}

.vazio{ background:#b3e5fc; }
.cheio{ background:#ffe082; }
.login{ background:#c8e6c9; }
.alianca{ background:#d1c4e9; }

.small{ font-size:12px; color:#555; }

.linha-botoes{
margin-top:6px;
display:flex;
gap:6px;
}

.linha-botoes button{
flex:1;
font-size:12px;
padding:8px;
}

.remove{ background:var(--vermelho); }
.whats{ background:var(--verde); }
.foto{ background:#6a1b9a; }

img{
width:100%;
margin-top:6px;
border-radius:8px;
}

.numero-seq{
font-size:12px;
font-weight:bold;
color:#555;
}
</style>
</head>

<body>

<h1>Controle de PÃ¡tio</h1>

<div class="box">
<input id="numero" placeholder="NÃºmero do contÃªiner">

<select id="tipo">
<option>Vazio</option>
<option>Cheio</option>
</select>

<select id="empresa">
<option>Login</option>
<option>AlianÃ§a</option>
</select>

<input id="local" placeholder="LocalizaÃ§Ã£o">

<select id="urgencia">
<option value="">Sem urgÃªncia</option>
<option value="Demurrage">Demurrage</option>
<option value="Deadline">Deadline</option>
</select>

<button onclick="adicionar()">Adicionar</button>
</div>

<div class="box">
<button onclick="pdfCompleto()">Gerar PDF</button>
</div>

<div class="urgencias" id="painelUrgencias"></div>

<div id="lista"></div>

<script>
let db = JSON.parse(localStorage.getItem("patio_db") || "[]");

function salvar(){
localStorage.setItem("patio_db", JSON.stringify(db));
}

function agora(){
return new Date().toLocaleString();
}

/* ðŸ”¥ FUNÃ‡ÃƒO CENTRAL DE ORDENAÃ‡ÃƒO */
function ordenados(){
return [...db].sort((a,b)=> a.numero.localeCompare(b.numero));
}

function adicionar(){
let numero = document.getElementById("numero").value.trim().toUpperCase();
if(!numero) return alert("Informe o nÃºmero");

db.push({
id: Date.now(),
numero,
tipo: document.getElementById("tipo").value,
empresa: document.getElementById("empresa").value,
local: document.getElementById("local").value,
urgencia: document.getElementById("urgencia").value,
foto:null,
entrada: agora(),
saiu:false,
saida:null,
motorista:null
});

document.getElementById("numero").value="";
document.getElementById("local").value="";
document.getElementById("urgencia").value="";
salvar();
render();
}

function saida(id){
let nome = prompt("Nome do motorista:");
if(!nome) return;

let c = db.find(x=>x.id===id);
c.saiu = true;
c.saida = agora();
c.motorista = nome;

salvar();
render();
}

function remover(id){
db = db.filter(x=>x.id!==id);
salvar();
render();
}

function whats(id){
let c = db.find(x=>x.id===id);
let msg =
`ContÃªiner: ${c.numero}
Tipo: ${c.tipo}
Empresa: ${c.empresa}
Local: ${c.local}
${c.urgencia ? "âš ï¸ "+c.urgencia : ""}`;

window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
}

function tirarFoto(id){
let input = document.createElement("input");
input.type="file";
input.accept="image/*";
input.capture="environment";

input.onchange = e=>{
let file = e.target.files[0];
let reader = new FileReader();
reader.onload = ()=>{
let c = db.find(x=>x.id===id);
c.foto = reader.result;
salvar();
render();
};
reader.readAsDataURL(file);
};

input.click();
}

/* PAINEL */
function atualizarUrgencias(){
let u = ordenados().filter(c=>c.urgencia && !c.saiu);

if(!u.length){
document.getElementById("painelUrgencias").innerHTML =
"<b>Painel de UrgÃªncias:</b> Nenhuma.";
return;
}

let html = "<b>Painel de UrgÃªncias:</b><br>";
u.forEach((c,i)=>{
html += `${i+1}. ${c.numero} (${c.urgencia})<br>`;
});

document.getElementById("painelUrgencias").innerHTML = html;
}

/* RENDER */
function render(){
atualizarUrgencias();

let lista = document.getElementById("lista");
lista.innerHTML="";

ordenados().forEach((c,i)=>{
let div = document.createElement("div");
div.className="card";

if(c.urgencia==="Demurrage") div.classList.add("demurrage");
if(c.urgencia==="Deadline") div.classList.add("deadline");
if(c.saiu) div.classList.add("saiu");

div.innerHTML=`
<div class="numero-seq">#${i+1}</div>
<b>${c.numero}</b><br>

<span class="tag ${c.tipo==='Vazio'?'vazio':'cheio'}">${c.tipo}</span>
<span class="tag ${c.empresa==='Login'?'login':'alianca'}">${c.empresa}</span>
${c.urgencia?`<span class="tag">${c.urgencia}</span>`:""}

<div>Local: ${c.local}</div>
<div class="small">Entrada: ${c.entrada}</div>
${c.saida?`<div class="small">SaÃ­da: ${c.saida}</div>`:""}
${c.motorista?`<div class="small">Motorista: ${c.motorista}</div>`:""}

${c.foto?`<img src="${c.foto}">`:""}

<div class="linha-botoes">
<button onclick="saida(${c.id})">SaÃ­da</button>
<button class="foto" onclick="tirarFoto(${c.id})">Foto</button>
<button class="whats" onclick="whats(${c.id})">Whats</button>
<button class="remove" onclick="remover(${c.id})">Remover</button>
</div>
`;

lista.appendChild(div);
});
}

/* PDF */
function pdfCompleto(){
const { jsPDF } = window.jspdf;
let doc = new jsPDF();

doc.setFontSize(16);
doc.text("RelatÃ³rio Operacional de ContÃªineres", 105, 15, {align:"center"});
doc.setFontSize(10);
doc.text("Gerado em: " + agora(), 10, 22);

let y = 30;

ordenados().forEach((c,i)=>{
doc.setFontSize(11);
doc.text(`#${i+1} - ${c.numero}`,10,y);
y+=6;

doc.setFontSize(10);
doc.text(`Tipo: ${c.tipo} | Empresa: ${c.empresa}`,10,y);
y+=6;

doc.text(`LocalizaÃ§Ã£o: ${c.local}`,10,y);
y+=6;

doc.text(`Entrada: ${c.entrada}`,10,y);
y+=6;

if(c.urgencia){
doc.text(`UrgÃªncia: ${c.urgencia}`,10,y);
y+=6;
}

if(c.saiu){
doc.text(`SaÃ­da: ${c.saida}`,10,y);
y+=6;
doc.text(`Motorista: ${c.motorista || "-"}`,10,y);
y+=6;
}

if(c.foto){
try{
doc.addImage(c.foto,"JPEG",130,y-30,60,40);
}catch(e){}
}

y+=12;

if(y>260){
doc.addPage();
y=20;
}
});

doc.save("relatorio_operacional.pdf");
}

render();
</script>

</body>
</html>
